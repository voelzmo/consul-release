---
name: consul_agent_windows
templates:
  certs/agent.crt.erb: config/certs/agent.crt
  certs/agent.key.erb: config/certs/agent.key
  certs/ca.crt.erb: config/certs/ca.crt
  confab.json.erb: confab.json
  consul_link.json.erb: consul_link.json
  pre-start.ps1.erb: bin/pre-start.ps1
  post-start.ps1.erb: bin/post-start.ps1

packages:
- consul-windows
- confab-windows

consumes:
- name: consul_common
  type: consul_common
  optional: true

properties:
  consul.agent.node_name_includes_id:
    description: "whether to include the unique spec.id in the node name"
    default: false

  consul.agent.servers.lan:
    description: "LAN server addresses to join on start."
    default: []

  consul.agent.servers.wan:
    description: "WAN server addresses to join."
    default: []

  consul.agent.log_level:
    description: "Agent log level."
    default: info

  consul.agent.datacenter:
    description: "Name of the agent's datacenter."
    default: dc1

  consul.agent.services:
    description: "Map of consul service definitions."
    default: {}

  consul.agent.dns_config.allow_stale:
    description: "Enables a stale query for DNS information. This allows any Consul server, rather than only the leader, to service the request."
    default: false

  consul.agent.dns_config.max_stale:
    description: "When allow_stale is specified, this is used to limit how stale results are allowed to be."
    default: "5s"

  consul.agent.dns_config.service_ttl:
    description: "TTL for service DNS"
    default: "0s"

  consul.agent.domain:
    description: "Domain suffix for DNS"

  consul.agent.require_ssl:
    description: "Require SSL to talk with the local agent"
    default: false

  consul.agent.rewrite_resolv:
    description: "When set to true this property will rewrite the resolv.conf file and add 127.0.0.1 as the first entry"
    default: true

  consul.agent.tls:
    description: "Agent cert, key, and CA for mTLS"

  consul.server.tls:
    description: "Server cert, key, and CA for mTLS"

  consul.encrypt_keys:
    description: "A list of passphrases that will be converted into encryption keys, the first key in the list is the active one"

  consul.client.enabled:
    description: "Set to false to disable the consul_agent on a VM."
    default: true

  syslog_daemon_config.address:
    description: "Syslog host"
    default: ""

  syslog_daemon_config.port:
    description: "Syslog port"
    default: ""

  syslog_daemon_config.transport:
    description: "Syslog transport protocol (tcp or udp)"
    default: "udp"
